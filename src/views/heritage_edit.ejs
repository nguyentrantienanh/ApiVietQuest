<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sửa Di Sản</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      body { padding: 2rem; background: #f8fafc; }
      .card-img-top { object-fit: cover; height: 220px; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Sửa Di Sản: <%= item.name %></h2>
        <a href="/heritages" class="btn btn-outline-secondary">Quay lại</a>
      </div>

      <% if (message) { %>
        <div class="alert alert-info"><%= message %></div>
      <% } %>

      <div class="card shadow-sm">
        <div class="card-body">
          <form action="/heritages/<%= item.hid %>/edit" method="post" enctype="multipart/form-data">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">HID</label>
                <input class="form-control" name="hid" value="<%= item.hid %>" readonly />
              </div>
              <div class="col-md-4">
                <label class="form-label">district_codename</label>
                <input class="form-control" name="district_codename" value="<%= item.district_codename %>" required />
              </div>
              <div class="col-md-4">
                <label class="form-label">Tên di sản</label>
                <input class="form-control" name="name" value="<%= item.name %>" required />
              </div>

              <div class="col-md-4">
                <label class="form-label">Loại</label>
                <select class="form-select" name="type" required>
                  <% const types = ['di_san_van_hoa_vat_the','di_san_van_hoa_phi_vat_the','di_san_thien_nhien']; %>
                  <% const TYPE_LABELS = { di_san_van_hoa_vat_the:'Di sản văn hoá vật thể', di_san_van_hoa_phi_vat_the:'Di sản văn hoá phi vật thể', di_san_thien_nhien:'Di sản thiên nhiên' }; %>
                  <% types.forEach(function(t){ %>
                    <option value="<%= t %>" <%= item.type===t? 'selected':'' %>><%= TYPE_LABELS[t] || t.replace(/_/g,' ') %></option>
                  <% }) %>
                </select>
              </div>

              <div class="col-md-4">
                <label class="form-label">Cấp bậc</label>
                <select class="form-select" name="level" required>
                  <% const levels = ['cap_tinh','cap_quoc_gia','cap_dac_biet','di_san_the_gioi','ds_phi_vat_the_dai_dien','ky_uc_the_gioi','khu_du_tru_sinh_quyen','cong_vien_dia_chat_toan_cau']; %>
                  <% const LEVEL_LABELS = { cap_tinh:'Cấp tỉnh', cap_quoc_gia:'Cấp quốc gia', cap_dac_biet:'Cấp đặc biệt', di_san_the_gioi:'Di sản thế giới', ds_phi_vat_the_dai_dien:'Phi vật thể đại diện', ky_uc_the_gioi:'Ký ức thế giới', khu_du_tru_sinh_quyen:'Khu dự trữ sinh quyển', cong_vien_dia_chat_toan_cau:'Công viên địa chất toàn cầu' }; %>
                  <% levels.forEach(function(l){ %>
                    <option value="<%= l %>" <%= item.level===l? 'selected':'' %>><%= LEVEL_LABELS[l] || l.replace(/_/g,' ') %></option>
                  <% }) %>
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label">Ảnh chính (bật thay)</label>
                <% if (item.img) { %>
                  <div class="mb-2"><img src="<%= item.img %>" class="img-fluid rounded" style="max-height:180px;object-fit:cover" /></div>
                <% } %>
                <input class="form-control" type="file" name="img" accept="image/*" />
              </div>

              <div class="col-md-6">
                <label class="form-label">Thư viện ảnh (có thể chọn thêm)</label>
                <div class="mb-2 d-flex flex-wrap g-2">
                  <% (item.photo_library||[]).forEach(function(p){ %>
                    <div style="width:80px;height:80px;margin-right:.5rem"><img src="<%= p %>" style="width:100%;height:100%;object-fit:cover" class="rounded"/></div>
                  <% }) %>
                </div>
                <input class="form-control" type="file" name="photo_library" accept="image/*" multiple />
              </div>

              <div class="col-12">
                <label class="form-label">Summary</label>
                <textarea class="form-control" name="Summary" rows="2"><%= item.Summary || '' %></textarea>
              </div>

              <div class="col-md-6">
                <label class="form-label">History</label>
                <textarea class="form-control" name="history" rows="4"><%= item.history || '' %></textarea>
              </div>
              <div class="col-md-6">
                <label class="form-label">Giá trị di sản</label>
                <textarea class="form-control" name="Heritage" rows="4"><%= item.Heritage || '' %></textarea>
              </div>

              <div class="col-12 text-end">
                <button class="btn btn-success">Lưu thay đổi</button>
                <a href="/heritages" class="btn btn-secondary ms-2">Huỷ</a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
